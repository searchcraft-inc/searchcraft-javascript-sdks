# Searchcraft Javascript SDKs

This project is a monorepo containing framework-specific javascript SDKs for use in front-end consuming applications of Searchcraft.

Each SDK provides the following functionality to the consumer:
- Pre-built components and functionality for the consuming application for the purpose of rendering search forms, search results, and filtering.
- Communicates with Searchcraft via the Searchcraft API.
- State management of search results, filtering, and settings.
- Ability to render ads in-line with search results.
- Analytics events sent to the Searchcraft /measure endpoint for viewing on the Vektron dashboard.

## Technologies
- yarn workspaces (yarn classic)
- Stencil
- Typescript

## Tooling
- Stencil output targets
- typedoc
- vite
- Storybook
- lerna
- biomejs
- nodemon
- Bitbucket pipelines
- `yalc`

## Local Development

### Installation
Install dependencies with `yarn install`.

### Building
Use the build script for local development. The build script handles all of the necessary build steps and build order. It can also handle watching the files and re-running the build during the course of development

```
node build.mjs [package-alias] [--watch] [--yalc]
```
For complete documentation on the build script, refer to the comment header in [build.mjs](build.mjs).

**Note**: To use the `--yalc` flag, you must have yalc installed on your machine.

### Storybook
The one of the workspaces in the project is `compendium`, which is responsible for managing the storybook stories for the SDKs.

To view storybook, run:
- `yarn storybook:react` (React-based stories)
- `yarn storybook:vue` (Vue-based stories)

Keeping `compendium` up-to-date is crucial and should be continuously referenced during the course of development.

### Versioning

We use [semver](https://semver.org/) (semantic versioning) for our versioning system.

### Publishing

A Bitbucket pipeline is set up to handle publishing to NPM. `lerna.json` is the source of truth for our versioning system.

To publish:
1. From the `development` branch, create a new branch called `version-x.x.x`.
2. Push this branch upstream.
3. Run `yarn version:sdks` and follow the prompts to select a major, minor, or patch version. The script will automatically increment the yarn workspace package's version numbers and push a commit to your branch.
4. On bitbucket, pull request to merge the changes up to main: `version-x.x.x` -> `development`, and then `development` -> `main`.
5. When `development` is merged into `main`, the pipeline will run, which will publish the changes to npm.

## Project Structure

### Core Package

The Core SDK package (`core-sdk`), is a private package that contains the shared business logic for communicating with the Searchcraft API. The other SDKs in the monorepo consume this package.

### Stencil Web Components

The stencil web components (`javascript-sdk`) serve as the base UI package for all the other framework SDKs. The components for other frameworks are generated by the stencil build. Output targets are specified by `stencil.config.ts`. The `javascript-sdk` can be thought of as the `core-ui` package.
